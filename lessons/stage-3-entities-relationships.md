# Stage 3: Entities & Relationships ๐๐ฆ

ุงููุฑุญูุฉ ุงูุญุงููุฉ ูู ุงูููุจ ุงููุงุจุถ ููุดุฑูุน **Valentina-Oxidized**. ูุฑูุฒ ูููุง ุนูู ุจูุงุก ุงูุนูุงูุงุช ุงูููุฏุณูุฉ ุงููุนูุฏุฉุ ูุชุญููู ุณุญุงุจุฉ ุงูููุงุท ุฅูู ูููู ููุฏุณู ูุชูุงูู ูุถู ุงูุฎุทูุทุ ุงูููุญููุงุชุ ุฃุฏูุงุช ุงูููุงุณ (ุงูููุตูุงุช)ุ ุงููุงุฌูุฉ ุงูุชูุงุนููุฉุ ููุธุงู ุฅุฏุงุฑุฉ ุญูุงุฉ ุงูุจูุงูุงุช.

## ุฌุฏูู ุงููุญุชููุงุช
1. [ูุธุงู ุงูุฎุทูุท (Lines System)](#ูุธุงู-ุงูุฎุทูุท)
2. [ููุญููุงุช ุจูุฒูู (Cubic Bezier Splines)](#ููุญููุงุช-ุจูุฒูู)
3. [ุฃุฏุงุฉ ุงูููุตู (Angle Bisector Tool)](#ุฃุฏุงุฉ-ุงูููุตู)
4. [ูุธุงู ุงูุงุฎุชูุงุฑ ุงูููุญุฏ (Global Selection)](#ูุธุงู-ุงูุงุฎุชูุงุฑ)
5. [ุชุณููุงุช ุงูููุงุท (SVG Text Labels)](#ุชุณููุงุช-ุงูููุงุท)
6. [ุงูุญุฐู ุงููุชุชุงูู (Cascading Deletion)](#ุงูุญุฐู-ุงููุชุชุงูู)
7. [ุญูุธ ูุงุณุชุฑุฌุงุน ุงููุดุฑูุน (JSON Persistence)](#ุญูุธ-ุงููุดุฑูุน)
8. [ุงูุชุญุฑูู ุงูุฏููุงูููู (Interactive Drag & Drop)](#ุงูุชุญุฑูู-ุงูุฏููุงูููู)
9. [ุงูุฑุจุท ุนุจุฑ ุงููุนุฑูุงุช (ID-based Linking)](#ุงูุฑุจุท-ุจุงููุนุฑูุงุช)
10. [ุงูุนูู ุงูุชููู: ุญููู ูุงุฌูุฉ ุงูู CAD](#ุงูุนูู-ุงูุชููู)

---

## 1. ูุธุงู ุงูุฎุทูุท (Lines System) {#ูุธุงู-ุงูุฎุทูุท}

ุจุฏุฃูุง ุจุชุนุฑูู `VLine` ููุฑุจุท ุจูู ููุทุชูู. ุงูุฎุท ูู Valentina ููุณ ูุฌุฑุฏ ุฑุณู ุตุงูุชุ ุจู ูู ุนูุงูุฉ ุฑูุงุถูุฉ ุชุญูู ุฎุตุงุฆุต ููุฏุณูุฉ:
- **ุญุณุงุจ ุงูุทูู (Euclidean Distance):** ุจุงุณุชุฎุฏุงู ูุธุฑูุฉ ููุซุงุบูุฑุณ.
- **ุญุณุงุจ ุฒุงููุฉ ุงูููู (Polar Angle):** ุจุงุณุชุฎุฏุงู `atan2`.

---

## 2. ููุญููุงุช ุจูุฒูู (Cubic Bezier Splines) {#ููุญููุงุช-ุจูุฒูู}

ููุฐูุง ุงูููุญููุงุช ุงูุชูุนูุจูุฉ ุงูุชู ุชุนุชูุฏ ุนูู 4 ููุงุท (P1, P2, P3, P4). ุจุฏูุงู ูู ุชูุณูู ุงูููุญูู ูุฏููุงู ููุง ูู ููุฏ C++ ุงููุฏููุ ูุนุชูุฏ ุนูู ูุญุฑู ุงูู Browser ูู ุฑุณู `SVG Path` ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ `C` ูุถูุงู ุฏูุฉ ูุชูุงููุฉ ูุฃุฏุงุก ุนุงูู ุฌุฏุงู.

---

## 3. ุฃุฏุงุฉ ุงูููุตู (Angle Bisector Tool) {#ุฃุฏุงุฉ-ุงูููุตู}

ุจุนุฏ ุชุญููู ููุฏ Valentina ุงูุฃุตูู (`vtoolbisector.cpp`)ุ ูููุง ุจุชูููุฐ ุฃุฏุงุฉ ููุตู ุงูุฒุงููุฉุ ููู ุฃูู ุฃุฏุงุฉ ูุฏููุง ุชููู ุจู **ุชูููุฏ ููุฏุณุฉ ุจูุงุกู ุนูู ุฒูุงูุง ูุชุบูุฑุฉ**.

### ุงูููุทู ุงูุฑูุงุถู (The Math):
ุงูููุตู ูุชุทูุจ 3 ููุงุท: (ููุทุฉ ุทุฑููุฉุ ุงูุฑุฃุณ/ุงูุฒุงููุฉุ ูููุทุฉ ุทุฑููุฉ ุฃุฎุฑู).
1. ูุญุณุจ ุงูุฒุงููุฉ ุจูู ุงูุดุนุงุนูู ุงูููุทูููู ูู ุงูุฑุฃุณ.
2. ูุฌุฏ "ุงูุฒุงููุฉ ุงููุชูุณุทุฉ" ุงูุชู ุชูุตู ุงููุฑุงุบ ุจููููุง.
3. ูููุฏ ุฅุญุฏุงุซูุงุช ููุทุฉ ุฌุฏูุฏุฉ ุชุจุนุฏ ูุณุงูุฉ ูุญุฏุฏุฉ (ุทูู ุงูููุตู) ุจูุฐู ุงูุฒุงููุฉ ุงููุชูุณุทุฉ.

### ุงูุชูููุฐ ุงูุจุฑูุฌู:
ุฃุถูุช ุฏุงูุฉ `calculate_end_point` ูู ูููู `VBisector` ูุชููู ุจุฅุนุงุฏุฉ ุญุณุงุจ ูููุน ููุงูุฉ ุงูููุตู ูุญุธูุงู ูููุง ุชุญุฑูุช ุฃู ูู ุงูููุงุท ุงูุซูุงุซ ุงูููููุฉ ูู.

---

## 4. ูุธุงู ุงูุงุฎุชูุงุฑ ุงูููุญุฏ (Global Selection) {#ูุธุงู-ุงูุงุฎุชูุงุฑ}

ูููุง ุจุจูุงุก ูุธุงู ุงุฎุชูุงุฑ ุดุงูู ูุนุชูุฏ ุนูู `SelectedItem` (Enum) ูุชูุซูู ุฃู ููุงู (ููุทุฉุ ุฎุทุ ููุญููุ ููุตู) ูุชู ุงุฎุชูุงุฑูุ ูุน ุชูููุฑ ุชุบุฐูุฉ ุจุตุฑู ุนุจุฑ CSS (Hover/Selection Glow).

---

## 5. ุชุณููุงุช ุงูููุงุท (SVG Text Labels) {#ุชุณููุงุช-ุงูููุงุท}

ุฃุถูุช ุชุณููุงุช ุญูุฉ ููููุงุท ุจุงุณุชุฎุฏุงู ูุณู `SVG Text` ูุน ุฅุฒุงุญุฉ ุฐููุฉ (`x+15, y-15`) ูุถูุงู ุงููุถูุญ ูุนุฏู ุงูุชุฏุงุฎู.

---

## 6. ุงูุญุฐู ุงููุชุชุงูู (Cascading Deletion) {#ุงูุญุฐู-ุงููุชุชุงูู}

ููุฐูุง ููุทู ุญูุงูุฉ ุงูุจูุงูุงุชุ ูุนูุฏ ุญุฐู ููุทุฉุ ูุชู ุชููุงุฆูุงู ุญุฐู ูู ุงูุฎุทูุท ูุงูููุญููุงุช ูุงูููุตูุงุช ุงููุฑุชุจุทุฉ ุจูุง ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `retain` ูู Rustุ ููุง ูููุน ูุฌูุฏ ุนูุงูุงุช "ูุชููุฉ".

---

## 7. ุญูุธ ูุงุณุชุฑุฌุงุน ุงููุดุฑูุน (JSON Persistence) {#ุญูุธ-ุงููุดุฑูุน}

ุงุณุชุฎุฏููุง ููุชุจุฉ `rfd` ููุชุญ ููุงูุฐ ูุธุงู ุงูุชุดุบูู ุงูุฃุตููุฉ ูุญูุธ ูุงุณุชุฑุฌุงุน ุงููููุงุชุ ูุน ุงุณุชุบูุงู ููุฉ `Serde` ูู ุชุญููู ุงูููุงูู ุจุงููุงูู ุฅูู JSON.

---

## 8. ุงูุชุญุฑูู ุงูุฏููุงูููู (Interactive Drag & Drop) {#ุงูุชุญุฑูู-ุงูุฏููุงูููู}

ุจูุถู ุงุณุชุฎุฏุงู ุงููุนุฑูุงุช (IDs) ููุฑุจุทุ ุฃุตุจุญ ุชุญุฑูู ุงูููุทุฉ ูุคุฏู ุชููุงุฆูุงู ูุชุญุฏูุซ ูุงูุฉ ุงูุชูุงุจุน (ุฎุทูุทุ ููุญููุงุชุ ููุตูุงุช) ูู ูู "ุฅุทุงุฑ ุฑุณู" (Render Frame) ุจุณูุงุณุฉ ุชุงูุฉ.

---

## 9. ุงูุฑุจุท ุนุจุฑ ุงููุนุฑูุงุช (ID-based Linking) {#ุงูุฑุจุท-ุจุงููุนุฑูุงุช}

ุงูุฑูู ุงูุฃุณุงุณู ูู ุชุตููููุง ุจู Rust ูุชุฌูุจ "ุฌุญูู ุงููุฑุงุฌุน" (Borrow Checker Hell). ุชุฎุฒู ุงูุนูุงูุงุช ุงููุนุฑูุงุช ุงููุฑูุฏุฉ (`u32`) ูุชุณุชุนูู ุนู ุงูุฅุญุฏุงุซูุงุช ุนูุฏ ุงูุญุงุฌุฉ ููุท.

---

## 10. ุงูุนูู ุงูุชููู: ุญููู ูุงุฌูุฉ ุงูู CAD {#ุงูุนูู-ุงูุชููู}

### ุฃ. ูุนุถูุฉ ุงูุฅุญุฏุงุซูุงุช (Coordinate Mapping)
ุงุณุชุฎุฏููุง `CoordMapper` ูุน `eval()` ูุฌูุจ ุฃุจุนุงุฏ ุงูุดุงุดุฉ ุงูุญููููุฉ ูุถูุงู ุฏูุฉ ุงูููุฑ 100%.

### ุจ. ุขูุฉ ุงูุญุงูุฉ ููุชูุงุนู (Interaction State Machine)
ุฅุฏุงุฑุฉ ุฎุทูุงุช ุงูุนูู ุงููุนูุฏุฉ (ูุซู ุงุฎุชูุงุฑ 3 ููุงุท ููููุตู) ุนุจุฑ `CanvasMode`.

### ุฌ. ุชุฌูุจ ุงูุชุฌููุฏ (Deadlock Prevention)
ุงุณุชุฎุฏุงู ุชูููุฉ **Snapshotting** ูุจู ุงูุฑุณู ูุถูุงู ุงุณุชุฌุงุจุฉ ุงููุงุฌูุฉ.

---

## ๐ ูุง ุงููุงุฏู ูู ุงููุฑุญูุฉ ุงูุซุงูุซุฉุ
- **Task 3.9:** ุงูุฑุจุท ุงููุบูู (ุฅูุดุงุก ูุณุงุฑุงุช ูุบููุฉ ูู ุฎุทูุท ูููุญููุงุช ูุนูู ูุทุน ุงูุจุงุชุฑูู).
- **Task 3.10:** ุชุญุณูู ุฃุฏูุงุช ุงูููุงุณ (ุฅุธูุงุฑ ุงูุทูู ูุงูุฒุงููุฉ ุจุฌุงูุจ ุงูุฎุทูุท ูู ุงูู Canvas).

**Valentina-Oxidized ูุชุทูุฑ ุงูุขู ูู ูุฌุฑุฏ ุฑุณู ููููู ูุญุฑู ุชุตููู ุฐูู! ๐ฆโจ**
