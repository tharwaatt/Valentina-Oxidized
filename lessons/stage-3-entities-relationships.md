# Stage 3: Entities & Relationships ๐๐ฆ

ุงููุฑุญูุฉ ุงูุญุงููุฉ ุชุฑูุฒ ุนูู ุจูุงุก ุงูุนูุงูุงุช ุจูู ุงูููุงูุงุช ุงูููุฏุณูุฉุ ูุชุญููู ุณุญุงุจุฉ ุงูููุงุท ุฅูู ูููู ููุฏุณู ูุชูุงูู ูุถู ุงูุฎุทูุท ูุงูููุญููุงุชุ ูุน ูุธุงู ุงุฎุชูุงุฑ ุชูุงุนูู ูุชุทูุฑ.

## ุฌุฏูู ุงููุญุชููุงุช
1. [ูุธุงู ุงูุฎุทูุท (Lines System)](#ูุธุงู-ุงูุฎุทูุท)
2. [ููุญููุงุช ุจูุฒูู (Cubic Bezier Splines)](#ููุญููุงุช-ุจูุฒูู)
3. [ูุธุงู ุงูุงุฎุชูุงุฑ ุงูููุญุฏ (Global Selection)](#ูุธุงู-ุงูุงุฎุชูุงุฑ)
4. [ุงูุฑุจุท ุนุจุฑ ุงููุนุฑูุงุช (ID-based Linking)](#ุงูุฑุจุท-ุจุงููุนุฑูุงุช)
5. [ุงูุนูู ุงูุชููู: ุญููู ูุงุฌูุฉ ุงูู CAD](#ุงูุนูู-ุงูุชููู)

---

## 1. ูุธุงู ุงูุฎุทูุท (Lines System) {#ูุธุงู-ุงูุฎุทูุท}

ุจุฏุฃูุง ุจุชุนุฑูู `VLine` ููุฑุจุท ุจูู ููุทุชูู. ุงูุฎุท ูู Valentina ููุณ ูุฌุฑุฏ ุฑุณูุ ุจู ูู ุนูุงูุฉ ุฑูุงุถูุฉ ุชุญูู ุฎุตุงุฆุต ูุซู ุงูุทูู ูุงูุฒุงููุฉ.

```rust
#[derive(Debug, Clone, PartialEq)]
pub struct VLine {
    pub metadata: VGObject,
    pub start_point_id: u32,
    pub end_point_id: u32,
}
```

ูููุง ุจุฏูุฌ ุงูุฑูุงุถูุงุช ูู ููุจ ุงููุงุฌูุฉ:
- **ุงูุทูู:** ุญุณุงุจ ุงููุณุงูุฉ ุงูุฅูููุฏูุฉ ุจูู ููุทุชู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ.
- **ุงูุฒุงููุฉ:** ุงุณุชุฎุฏุงู `atan2` ูุชุญุฏูุฏ ููู ุงูุฎุท ุจุงูุฏุฑุฌุงุช.

---

## 2. ููุญููุงุช ุจูุฒูู (Cubic Bezier Splines) {#ููุญููุงุช-ุจูุฒูู}

ุจุนุฏ ุชุญููู ููุฏ Valentina ุงูุฃุตูู (`vcubicbezier.cpp`)ุ ูููุง ุจุชูููุฐ ุงูููุญููุงุช ุงูุชูุนูุจูุฉ ุงูุชู ุชุนุชูุฏ ุนูู 4 ููุงุท: (ุงูุจุฏุงูุฉุ ููุทุชุง ุชุญููุ ุงูููุงูุฉ).

### ููุณูุฉ ุฅุนุงุฏุฉ ุงูููุฏุณุฉ (Re-engineering)
ูู ููุฏ C++ุ ูููู ุงููุญุฑู ุจุชูุณูู ุงูููุญูู ูุฏููุงู ุฅูู ููุงุท ุตุบูุฑุฉ ูุฑุณูู. ูู Rust/Dioxusุ ุงุชุฎุฐูุง ูุฑุงุฑุงู ุฃุฐูู:
- **ุชุฎุฒูู ุงูุจูุงูุงุช**: ูุฎุฒู ููุท ุงููุนุฑูุงุช (IDs) ููููุงุท ุงูุฃุฑุจุนุฉ ูู ูููู `VCubicBezier`.
- **ุงูุฑุณู**: ูุนุชูุฏ ุนูู ููุฉ ูุชุตูุญ ุงูููุจ ูู ุฑุณู `SVG Path` ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ `C` (Cubic Bezier). ูุฐุง ูููุฑ ุฏูุฉ ูุชูุงููุฉ ูุฃุฏุงุกู ุนุงููุงู ุฌุฏุงู ุฏูู ุงูุญุงุฌุฉ ูุญุณุงุจุงุช ุชูุณูู ูุนูุฏุฉ.

---

## 3. ูุธุงู ุงูุงุฎุชูุงุฑ ุงูููุญุฏ (Global Selection) {#ูุธุงู-ุงูุงุฎุชูุงุฑ}

ูุชุญููู ุงูุฑุณู ุงูุตุงูุช ุฅูู ูุงุฌูุฉ ุชูุงุนููุฉุ ูููุง ุจุจูุงุก ูุธุงู ุงุฎุชูุงุฑ ุดุงูู:
- **SelectedItem (Enum):** ููุซู ุงูููุงู ุงููุฎุชุงุฑ ุญุงููุงู (None, Point, Line, Spline).
- **ุงูุชูุงุนู ุงูุจุตุฑู (CSS):** ุงุณุชุฎุฏููุง ูุฆุงุช CSS ูุซู `.selected` ู `:hover` ูุฅุนุทุงุก ุชุฃุซูุฑ ุงูุชููุฌ (Glow) ูุชุบููุฑ ุงูุณูู ุนูุฏ ุชูุงุนู ุงููุณุชุฎุฏู ูุน ุฃู ุนูุตุฑ.
- **ุฅูุบุงุก ุงูุงุฎุชูุงุฑ:** ุจุฑูุฌูุง ุฎูููุฉ ุงูุดุจูุฉ (Grid) ูุชููู ุจุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุงุฎุชูุงุฑ ุนูุฏ ุงูุถุบุท ุนูู ุงููุฑุงุบุ ููุง ูููุฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุดุงุจูุฉ ูุจุฑุงูุฌ ุงูุชุตููู ุงูุงุญุชุฑุงููุฉ.

---

## 4. ุงูุฑุจุท ุนุจุฑ ุงููุนุฑูุงุช (ID-based Linking) {#ุงูุฑุจุท-ุจุงููุนุฑูุงุช}

ูุชุฌูุจ ุชุนููุฏุงุช ุงูู Borrow Checker ูู Rustุ ูุชู ุฑุจุท ุงููุงุฆูุงุช ุนุจุฑ **ุงููุนุฑูุงุช (IDs)**. ูุฐุง ูุณูุญ ุจุชุนุฏูู ุฃู ููุทุฉ ูู ุงููุณุชูุจู ููุชุญุฑู ุงูููุญูู ุฃู ุงูุฎุท ุงููุฑุชุจุท ุจูุง ุชููุงุฆูุงู ุฏูู ุงูุญุงุฌุฉ ูุฅุฏุงุฑุฉ ูุฑุงุฌุน ุงูุฐุงูุฑุฉ (References) ุงููุนูุฏุฉ.

---

## 5. ุงูุนูู ุงูุชููู: ุญููู ูุงุฌูุฉ ุงูู CAD {#ุงูุนูู-ุงูุชููู}

ุฎูุงู ุชุทููุฑ ูุฐู ุงููุฑุญูุฉุ ูุงุฌููุง ุชุญุฏูุงุช ุชูููุฉ ูู ุจูุฆุฉ **Dioxus 0.7** ููููุง ุจุญููุง ุจุฃุณุงููุจ ููุฏุณูุฉ:

### ุฃ. ูุนุถูุฉ ุงูุฅุญุฏุงุซูุงุช (Coordinate Mapping)
ุงูุชุดููุง ุฃู ุฅุญุฏุงุซูุงุช ุงููุงูุณ (CSS Pixels) ุชุฎุชูู ุนู ุฅุญุฏุงุซูุงุช ุงูู SVG (ViewBox Units).
- **ุงูุญู:** ุจูุงุก ููุฏููู `canvas_coords` ุงูุฐู ูุณุชุฎุฏู ููุฏ JavaScript ุนุจุฑ `eval()` ูุฌูุจ ุฃุจุนุงุฏ ุงูุดุงุดุฉ ุงููุนููุฉุ ุซู ุชุทุจูู ูุนุงุฏูุงุช ุงูุชุญููู ุงูุฑูุงุถู ูุถูุงู ุธููุฑ ุงูููุทุฉ ุชุญุช ุงููุงูุณ ุจุฏูุฉ 100%.

### ุจ. ุขูุฉ ุงูุญุงูุฉ ููุชูุงุนู (Interaction State Machine)
ุงูุงุนุชูุงุฏ ุนูู ุฅููุงู ุงูุชุดุงุฑ ุงูุฃุญุฏุงุซ (`stop_propagation`) ูู ููู ูุงููุงู ูู WebView.
- **ุงูุญู:** ุงุณุชุฎุฏููุง `CanvasMode` (Enum) ูุฅุฏุงุฑุฉ ุฎุทูุงุช ุงุฎุชูุงุฑ ุงูููุงุท ุงููุชุนุฏุฏุฉ ููููุญููุงุช ูุงูุฎุทูุทุ ููุง ุถูู ุงุณุชูุฑุงุฑ ุงูููุทู ุงูุจุฑูุฌู.

### ุฌ. ุงูุฃุฏุงุก ูุชุฌูุจ ุงูู Deadlocks
ูู Rustุ ุงููุตูู ุงููุชุฒุงูู ููุจูุงูุงุช ุญุณุงุณ ุฌุฏุงู.
- **ุงูุญู:** ุงุณุชุฎุฏุงู ุชูููุฉ **Snapshotting** (ุฃุฎุฐ ููุทุฉ ูู ุงูุจูุงูุงุช ุนุจุฑ `.clone()`) ูุจู ุงูุจุฏุก ูู ุนูููุฉ ุงูุฑุณู (Rendering)ุ ููุง ูููุน ุญุฏูุซ ุชุฌูุฏ ูู ุงูุจุฑูุงูุฌ ุนูุฏ ูุญุงููุฉ ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ูู ููุณ ุงูููุช.

---

## ๐ ูุง ุงููุงุฏู ูู ุงููุฑุญูุฉ ุงูุซุงูุซุฉุ
- **Task 3.4:** ุชุณููุงุช ุงูููุงุท (Labels) ุฏุงุฎู ุงูู Canvas (ูุซู P1, P2).
- **Task 3.5:** ุนูููุงุช ุงูุญุฐู (Deletion) ูุฅุฏุงุฑุฉ ุชูุงุจุน ุงูุจูุงูุงุช.

**ุงุณุชูุฑ ูู ุจูุงุก ุงููุณุชูุจู ุจู Rust! ๐ฆโจ**
